<!DOCTYPE html>
<html>
<head>
	<title>Monna MyStory 4.0 -- HaxiDenti</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style type="text/css">
		#buttons button {
			display: block;
			width: 99%;
			border-radius: 0px 32px;
			color: white;
			background-color: rgba(0, 0, 0, .5);
			transition: 200ms;
			font-size: 24px;
			margin-left: 20%;
			width: 60%;
		}

		#buttons button:hover {
			background-color: white;
			color: black;
			border-radius: 32px 0px;
			margin-left: 0%;
			width: 100%;
		}

		#app {
			position: absolute;
			width: 80%;
			left: 10%;
		}

		#text {
			font-size: 24px;
			border-radius: 32px;
			padding: 32px;
			border: none;
			background-color: rgba(0, 0, 0, .4);
			color: white;
			transition: 300ms;
			overflow: auto;
		}

		#body {
			transition: 300ms;
		}

		#images img {
			transition: 1000ms;
		}
	</style>
</head>
<body>

	<div id=images></div>
	<div id=app>
		<div id=text></div> 
		<div id=buttons></div>
	</div>

	<script type="text/javascript">
		var chapters = [];
		function _chapter(name, sceneName) {
			chapters.push(
				{name: name, scene: sceneName}
			);
		}

		// Save and load the game
		var mem = {}
		function save(slot) {
			memjson = JSON.stringify(mem);
			localStorage.setItem('slot_' + slot, memjson);
		}

		function load(slot) {
			memjson = localStorage.getItem('slot_' + slot);
			mem = JSON.parse(memjson);
		}

		// Timers
		window.addEventListener("load", function() {
			setInterval(function() {
				var height = window.innerHeight;
				var appHeight = document.getElementById("app").offsetHeight;
				var newTopPos = ((height / 2) - appHeight/2);
				if (newTopPos < 0) newTopPos = 0;
				document.getElementById("app").style.top = newTopPos + "px";
				document.body.style['background-size'] = "100% " + height + "px";
			}, 100);

			// Animation for added images
			var an = 0;
			setInterval(function() {
				var images = document.getElementById("images").children;
				function move(ypos) {
					for (var i = 0; i < images.length; i++) {
						var y = parseInt(images[i].style.bottom);
						y += ypos;
						images[i].style.bottom = y + "px";
					}
				}

				if (an == 0) {
					move(10); an = 1;
				} else {
					move(-10) ; an = 0;
				}
			}, 1000);
		})

		function button(caption, oncl) {
			var b = document.createElement("button");
			b.innerHTML = caption;
			b.onclick = oncl;
			var div = document.getElementById("buttons");
			div.appendChild(b);
		}

		function clear() {
			document.getElementById("text"   ).innerHTML = "";
			document.getElementById("buttons").innerHTML = "";
		}

		function print(txt) {
			printnb(txt + "<br>");
		}

		function printnb(txt) {
			var div = document.getElementById("text");
			div.innerHTML += txt;
		}

		function bgImg(src) {
			var height = window.innerHeight;
			document.body.style['background-image'] = "url("+src+")";
			document.body.style['background-repeat'] = "no-repeat";
			document.body.style['background-attachment'] = "fixed";
			document.body.style['transition'] = "200ms";
		}

		var sound = new Audio();
		function snd(src) {
			if (src == undefined
				|| src == ""
				|| src == "."
			) {
				sound.currentTime = 0;
				sound.pause();
			}
			sound.src = src;
			sound.currentTime = 0;
			sound.play();
		}


		var music = new Audio();
		music.volume = 0.4;
		music.loop = true;
		function mus(src) {
			if (src == undefined
				|| src == ""
				|| src == "."
			) {
				music.currentTime = 0;
				music.pause();
			}
			music.src = src;
			music.currentTime = 0;
			music.play();
		}

		function _next(name, del, auto) {
			setTimeout(function() {
				var ev  = name + "();";
				if (!auto) {
					button("Next &gt;&gt;", function() { eval(ev); });
				} else {
					fun();
				}
			}, del);
		}

		function img_set(src, x, y, w, h) {
			var div = document.getElementById("images");
			var img = document.createElement("img");
			img.src = src;
			img.style.position = "absolute";
			img.style.left     = x + "%";
			img.style.top      = y + "%";
			img.style.width    = w + "%";
			img.style.height   = h + "%";
			div.appendChild(img);
		}

		function img_side(src, left) {
			var div = document.getElementById("images");
			var img = document.createElement("img");
			img.src = src;
			img.style.position = "absolute";
			img.style.bottom = "10px";
			img.style.width = "30%";
			if (left) {
				img.style.left = "0px";
			} else {
				img.style.right = "0px";
				img.style.transform = "scaleX(-1)";
			}
			div.appendChild(img);
		}

		function img_clear() {
			var div = document.getElementById("images");
			div.innerHTML = "";
		}

		function _text_hide(flag) {
			var div = document.getElementById("text");
			if (flag) {
				div.style.opacity = 0;
			} else {
				div.style.opacity = 1;
			}
		}

		function _chapterButtons() {
			chapters.forEach(function(chapter, i, arr) {


				button((i + 1) + ". " + chapter.name, function() {4
					eval(chapter.scene + "();");
				});
			})
		}

		function _chapterButton(caption, chName) {
			function findChapter(name) {
				var found;
				chapters.forEach(function (e) { 
					if (e.name == name) {
						found = e;
						return; // break
					}
				});
				return found;
			}

			var chapter = findChapter(chName);
			if (chapter) {
				button(caption, function() { eval(chapter.scene + "();"); });
			}
		}

function scene_0() {
clear();
var current = "scene_0";
var currentF = scene_0;
_next('scene_1', 0, false);
bgImg('res/logo.jpg');
print('Monna MyStory * HaxiDenti Ihor-fox [UA] 2018');
print('V4.4');
print('Choose your chapter');
_chapterButtons();
}

_chapter('Начало', 'scene_1');
function scene_1() {
clear();
var current = "scene_1";
var currentF = scene_1;
_next('scene_2', 0, false);
bgImg('res/01.jpg');
print('Они стояли вместе держась за руки');
}

function scene_2() {
clear();
var current = "scene_2";
var currentF = scene_2;
_next('scene_3', 1000, false);
print('В одном дыхании,');
}

function scene_3() {
clear();
var current = "scene_3";
var currentF = scene_3;
_next('scene_4', 1000, false);
print('Они ожидали прихода в рай.');
}

function scene_4() {
clear();
var current = "scene_4";
var currentF = scene_4;
_next('scene_5', 1000, false);
print('Конец был близко, но они знали...');
}

function scene_5() {
clear();
var current = "scene_5";
var currentF = scene_5;
_next('scene_6', 1000, false);
print('знали, каков будет Господний рай,');
}

function scene_6() {
clear();
var current = "scene_6";
var currentF = scene_6;
_next('scene_7', 1000, false);
bgImg('res/02.jpeg');
print('на новой земле.');
}

function scene_7() {
clear();
var current = "scene_7";
var currentF = scene_7;
_next('scene_8', 1000, false);
print('И вот удар!');
}

function scene_8() {
clear();
var current = "scene_8";
var currentF = scene_8;
_next('scene_9', 1000, false);
print('Все померкло!');
}

function scene_9() {
clear();
var current = "scene_9";
var currentF = scene_9;
_next('scene_10', 1000, false);
print('И руки они не отпустили,');
}

function scene_10() {
clear();
var current = "scene_10";
var currentF = scene_10;
_next('scene_11', 1000, false);
print('Все так-же держась,');
}

function scene_11() {
clear();
var current = "scene_11";
var currentF = scene_11;
_next('scene_12', 1000, false);
print('они были похоронены,');
}

function scene_12() {
clear();
var current = "scene_12";
var currentF = scene_12;
print('А их души навеки воссоедены');
}



scene_0();

	</script>

</body>
</html>